<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 15px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>Windows API Test</h1>
    
    <div class="test-section">
        <h2>1. OS Detection</h2>
        <div id="os-info"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Auth API Test</h2>
        <div>
            <input type="text" id="login" placeholder="Login" value="test">
            <input type="password" id="password" placeholder="Password" value="test">
            <button onclick="testLogin()">Test Login</button>
            <button onclick="testRegister()">Test Register</button>
            <button onclick="testLogout()">Test Logout</button>
        </div>
        <div id="auth-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. User Info</h2>
        <button onclick="getUserInfo()">Get User Info</button>
        <div id="user-result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Likes API Test</h2>
        <button onclick="getLikes()">Get Likes</button>
        <button onclick="testTrackLike()">Like Track 1</button>
        <button onclick="testAlbumLike()">Like Album Test</button>
        <div id="likes-result"></div>
    </div>
    
    <script>
        // OS Detection
        const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
        const isWindows = navigator.platform.toUpperCase().indexOf('WIN') >= 0;
        
        document.getElementById('os-info').innerHTML = `
            <p><strong>Platform:</strong> ${navigator.platform}</p>
            <p><strong>Is Mac:</strong> ${isMac}</p>
            <p><strong>Is Windows:</strong> ${isWindows}</p>
            <p><strong>Auth API:</strong> ${isWindows ? '/muzic2/src/api/windows_auth.php' : '/muzic2/src/api/login.php'}</p>
            <p><strong>Likes API:</strong> ${isWindows ? '/muzic2/src/api/windows_likes.php' : '/muzic2/src/api/likes.php'}</p>
        `;
        
        // API endpoints
        const getAuthAPI = () => isWindows ? '/muzic2/src/api/windows_auth.php' : '/muzic2/src/api/login.php';
        const getUserAPI = () => isWindows ? '/muzic2/src/api/windows_auth.php' : '/muzic2/src/api/user.php';
        const getLikesAPI = () => isWindows ? '/muzic2/src/api/windows_likes.php' : '/muzic2/src/api/likes.php';
        
        async function testLogin() {
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            
            try {
                const res = await fetch(getAuthAPI(), {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'login',
                        login,
                        password
                    })
                });
                
                const data = await res.json();
                document.getElementById('auth-result').innerHTML = `
                    <div class="${res.ok ? 'success' : 'error'}">
                        <strong>Login Result:</strong> ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (e) {
                document.getElementById('auth-result').innerHTML = `
                    <div class="error">Error: ${e.message}</div>
                `;
            }
        }
        
        async function testRegister() {
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            
            try {
                const res = await fetch(getAuthAPI(), {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'register',
                        email: login + '@test.com',
                        username: login,
                        password
                    })
                });
                
                const data = await res.json();
                document.getElementById('auth-result').innerHTML = `
                    <div class="${res.ok ? 'success' : 'error'}">
                        <strong>Register Result:</strong> ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (e) {
                document.getElementById('auth-result').innerHTML = `
                    <div class="error">Error: ${e.message}</div>
                `;
            }
        }
        
        async function testLogout() {
            try {
                const res = await fetch(getAuthAPI(), {
                    method: 'DELETE',
                    credentials: 'include'
                });
                
                const data = await res.json();
                document.getElementById('auth-result').innerHTML = `
                    <div class="${res.ok ? 'success' : 'error'}">
                        <strong>Logout Result:</strong> ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (e) {
                document.getElementById('auth-result').innerHTML = `
                    <div class="error">Error: ${e.message}</div>
                `;
            }
        }
        
        async function getUserInfo() {
            try {
                const res = await fetch(getUserAPI(), {
                    credentials: 'include'
                });
                
                const data = await res.json();
                document.getElementById('user-result').innerHTML = `
                    <div class="${res.ok ? 'success' : 'error'}">
                        <strong>User Info:</strong> ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (e) {
                document.getElementById('user-result').innerHTML = `
                    <div class="error">Error: ${e.message}</div>
                `;
            }
        }
        
        async function getLikes() {
            try {
                const res = await fetch(getLikesAPI(), {
                    credentials: 'include'
                });
                
                const data = await res.json();
                document.getElementById('likes-result').innerHTML = `
                    <div class="${res.ok ? 'success' : 'error'}">
                        <strong>Likes:</strong> ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (e) {
                document.getElementById('likes-result').innerHTML = `
                    <div class="error">Error: ${e.message}</div>
                `;
            }
        }
        
        async function testTrackLike() {
            try {
                const res = await fetch(getLikesAPI(), {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ track_id: 1 })
                });
                
                const data = await res.json();
                document.getElementById('likes-result').innerHTML = `
                    <div class="${res.ok ? 'success' : 'error'}">
                        <strong>Track Like Result:</strong> ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (e) {
                document.getElementById('likes-result').innerHTML = `
                    <div class="error">Error: ${e.message}</div>
                `;
            }
        }
        
        async function testAlbumLike() {
            try {
                const res = await fetch(getLikesAPI(), {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ album_title: 'Test Album' })
                });
                
                const data = await res.json();
                document.getElementById('likes-result').innerHTML = `
                    <div class="${res.ok ? 'success' : 'error'}">
                        <strong>Album Like Result:</strong> ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (e) {
                document.getElementById('likes-result').innerHTML = `
                    <div class="error">Error: ${e.message}</div>
                `;
            }
        }
    </script>
</body>
</html>