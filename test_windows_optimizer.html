<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows DB Optimizer Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #6c757d;
            margin-top: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .data-preview {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñ•Ô∏è Windows DB Optimizer Test</h1>
        
        <div class="test-section">
            <h2>üöÄ –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã</h2>
            <button onclick="testAllData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="testIndividual()">–¢–µ—Å—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</button>
            <button onclick="runBenchmark()">–ë–µ–Ω—á–º–∞—Ä–∫</button>
            <button onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
        </div>
        
        <div id="results"></div>
        
        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="total-tracks">-</div>
                <div class="stat-label">–¢—Ä–µ–∫–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-albums">-</div>
                <div class="stat-label">–ê–ª—å–±–æ–º–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-artists">-</div>
                <div class="stat-label">–ê—Ä—Ç–∏—Å—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="load-time">-</div>
                <div class="stat-label">–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (–º—Å)</div>
            </div>
        </div>
        
        <div id="data-preview" style="display: none;">
            <h3>üìä –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</h3>
            <div class="data-preview" id="preview-content"></div>
        </div>
    </div>

    <script src="/muzic2/public/assets/js/windows_db_optimizer.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');
        const statsDiv = document.getElementById('stats');
        const previewDiv = document.getElementById('data-preview');
        const previewContent = document.getElementById('preview-content');
        
        function addResult(title, status, message, data = null) {
            const div = document.createElement('div');
            div.className = `test-section ${status}`;
            div.innerHTML = `<h3>${title}</h3><p>${message}</p>`;
            
            if (data) {
                const pre = document.createElement('pre');
                pre.className = 'data-preview';
                pre.textContent = JSON.stringify(data, null, 2);
                div.appendChild(pre);
            }
            
            resultsDiv.appendChild(div);
        }
        
        async function testAllData() {
            addResult('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö', 'loading', '–ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º...');
            
            try {
                const start = performance.now();
                const data = await window.windowsDBOptimizer.getAllData();
                const time = Math.round(performance.now() - start);
                
                addResult('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success', 
                    `–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞ ${time}ms (—Å–µ—Ä–≤–µ—Ä: ${data.load_time_ms}ms). ` +
                    `–¢—Ä–µ–∫–æ–≤: ${data.tracks.length}, –ê–ª—å–±–æ–º–æ–≤: ${data.albums.length}, –ê—Ä—Ç–∏—Å—Ç–æ–≤: ${data.artists.length}`,
                    data
                );
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('total-tracks').textContent = data.stats.total_tracks;
                document.getElementById('total-albums').textContent = data.stats.total_albums;
                document.getElementById('total-artists').textContent = data.stats.total_artists;
                document.getElementById('load-time').textContent = data.load_time_ms;
                statsDiv.style.display = 'grid';
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
                previewContent.textContent = JSON.stringify(data, null, 2);
                previewDiv.style.display = 'block';
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error', error.message);
            }
        }
        
        async function testIndividual() {
            addResult('üîÑ –¢–µ—Å—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤', 'loading', '–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã...');
            
            const tests = [
                { name: '–¢—Ä–µ–∫–∏', fn: () => window.windowsDBOptimizer.getTracks() },
                { name: '–ê–ª—å–±–æ–º—ã', fn: () => window.windowsDBOptimizer.getAlbums() },
                { name: '–ê—Ä—Ç–∏—Å—Ç—ã', fn: () => window.windowsDBOptimizer.getArtists() },
                { name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', fn: () => window.windowsDBOptimizer.getUser() },
                { name: '–õ–∞–π–∫–∏', fn: () => window.windowsDBOptimizer.getLikes() },
                { name: '–ü–ª–µ–π–ª–∏—Å—Ç—ã', fn: () => window.windowsDBOptimizer.getPlaylists() }
            ];
            
            for (const test of tests) {
                try {
                    const start = performance.now();
                    const data = await test.fn();
                    const time = Math.round(performance.now() - start);
                    
                    addResult(`‚úÖ ${test.name}`, 'success', 
                        `–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞ ${time}ms. –ó–∞–ø–∏—Å–µ–π: ${Array.isArray(data) ? data.length : 'N/A'}`);
                        
                } catch (error) {
                    addResult(`‚ùå ${test.name}`, 'error', error.message);
                }
            }
        }
        
        async function runBenchmark() {
            addResult('üèÅ –ë–µ–Ω—á–º–∞—Ä–∫', 'loading', '–ó–∞–ø—É—Å–∫–∞–µ–º –±–µ–Ω—á–º–∞—Ä–∫...');
            
            try {
                const results = await window.windowsDBOptimizer.benchmark();
                
                let message = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–∞:\n';
                results.forEach(result => {
                    if (result.status === 'success') {
                        message += `‚úÖ ${result.name}: ${result.time}ms\n`;
                    } else {
                        message += `‚ùå ${result.name}: ${result.error}\n`;
                    }
                });
                
                addResult('üìä –ë–µ–Ω—á–º–∞—Ä–∫ –∑–∞–≤–µ—Ä—à–µ–Ω', 'success', message);
                
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞ –±–µ–Ω—á–º–∞—Ä–∫–∞', 'error', error.message);
            }
        }
        
        function clearCache() {
            window.windowsDBOptimizer.clearCache();
            addResult('üóëÔ∏è –ö—ç—à –æ—á–∏—â–µ–Ω', 'success', '–ö—ç—à –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(testAllData, 1000);
        });
    </script>
</body>
</html>
